<!-- Simple Team Selection JavaScript -->
<script>
// Team data structure - make it globally accessible
window.allTeams = {
    'Premier League': [
        'Arsenal', 'Aston Villa', 'Bournemouth', 'Brentford', 'Brighton & Hove Albion',
        'Burnley', 'Chelsea', 'Crystal Palace', 'Everton', 'Fulham',
        'Liverpool', 'Luton Town', 'Manchester City', 'Manchester United', 'Newcastle United',
        'Nottingham Forest', 'Sheffield United', 'Tottenham Hotspur', 'West Ham United', 'Wolverhampton Wanderers'
    ],
    'La Liga': [
        'Almería', 'Athletic Club', 'Atletico Madrid', 'Barcelona', 'Cadiz',
        'Celta Vigo', 'Getafe', 'Girona', 'Granada CF', 'Las Palmas',
        'Mallorca', 'Osasuna', 'Rayo Vallecano', 'Real Betis', 'Real Madrid',
        'Real Sociedad', 'Sevilla', 'Valencia', 'Villarreal', 'Alaves'
    ],
    'Serie A': [
        'AC Milan', 'AS Roma', 'Atalanta', 'Bologna', 'Cagliari',
        'Empoli', 'Fiorentina', 'Frosinone', 'Genoa', 'Hellas Verona',
        'Inter', 'Juventus', 'Lazio', 'Lecce', 'Monza',
        'Napoli', 'Salernitana', 'Sassuolo', 'Torino', 'Udinese'
    ],
    'Bundesliga': [
        '1. FC Heidenheim 1846', '1. FC Köln', '1. FC Union Berlin', 'Bayer Leverkusen', 'Bayern München',
        'Borussia Dortmund', 'Borussia Mönchengladbach', 'Darmstadt 98', 'Eintracht Frankfurt', 'FC Augsburg',
        'RB Leipzig', 'SC Freiburg', 'SV Werder Bremen', 'TSG Hoffenheim', 'VfB Stuttgart',
        'VfL Bochum 1848', 'VfL Wolfsburg', 'Mainz 05'
    ],
    'Ligue 1': [
        'Brest', 'Clermont', 'Le Havre', 'Lens', 'Lille',
        'Lorient', 'Lyon', 'Marseille', 'Metz', 'Monaco',
        'Montpellier', 'Nantes', 'Nice', 'Paris Saint Germain', 'Reims',
        'Rennes', 'Strasbourg', 'Toulouse'
    ],
    'International': [
        'Argentina', 'Belgium', 'Brazil', 'Croatia', 'Denmark',
        'England', 'France', 'Germany', 'Italy', 'Mexico',
        'Morocco', 'Netherlands', 'Nigeria', 'Poland', 'Portugal',
        'Senegal', 'Serbia', 'South Korea', 'Spain', 'Switzerland',
        'Uruguay', 'USA', 'Wales'
    ]
};

// Initialize team dropdowns with search - make it global
window.initializeTeamSelects = function() {
    console.log('Initializing team selects...');
    window.populateDropdown('home');
    window.populateDropdown('away');
}

// Populate dropdown with teams - make it global
window.populateDropdown = function(side) {
    const dropdownContent = document.getElementById(side + 'DropdownContent');
    if (!dropdownContent) return;
    
    dropdownContent.innerHTML = '';
    
    Object.keys(allTeams).forEach(league => {
        // Add league header
        const leagueHeader = document.createElement('div');
        leagueHeader.className = 'league-header';
        leagueHeader.textContent = league;
        dropdownContent.appendChild(leagueHeader);
        
        // Add teams
        allTeams[league].forEach(team => {
            const teamOption = document.createElement('div');
            teamOption.className = 'team-option';
            teamOption.innerHTML = `
                <span class="team-flag">${getTeamFlag(league)}</span>
                <span>${team}</span>
            `;
            teamOption.addEventListener('click', () => selectTeam(side, team));
            dropdownContent.appendChild(teamOption);
        });
    });
}

// Get team flag emoji
function getTeamFlag(league) {
    const flags = {
        'Premier League': '🏴',
        'La Liga': '🇪🇸',
        'Serie A': '🇮🇹',
        'Bundesliga': '🇩🇪',
        'Ligue 1': '🇫🇷',
        'International': '🌍'
    };
    return flags[league] || '⚽';
}

// Show dropdown - make it globally accessible
window.showDropdown = function(side) {
    const dropdown = document.getElementById(side + 'Dropdown');
    if (dropdown) {
        dropdown.classList.add('show');
        // Hide other dropdown
        const otherSide = side === 'home' ? 'away' : 'home';
        const otherDropdown = document.getElementById(otherSide + 'Dropdown');
        if (otherDropdown) {
            otherDropdown.classList.remove('show');
        }
    }
}

// Hide dropdowns when clicking outside
document.addEventListener('click', function(event) {
    if (!event.target.closest('.search-container')) {
        document.querySelectorAll('.search-dropdown').forEach(dropdown => {
            dropdown.classList.remove('show');
        });
    }
});

// Filter teams based on search - make it globally accessible
window.filterTeams = function(side) {
    const searchInput = document.getElementById(side + 'TeamSearch');
    const filter = searchInput.value.toLowerCase();
    const dropdownContent = document.getElementById(side + 'DropdownContent');
    
    if (!dropdownContent) return;
    
    dropdownContent.innerHTML = '';
    
    let hasResults = false;
    
    Object.keys(allTeams).forEach(league => {
        const filteredTeams = allTeams[league].filter(team => 
            team.toLowerCase().includes(filter)
        );
        
        if (filteredTeams.length > 0) {
            hasResults = true;
            
            // Add league header
            const leagueHeader = document.createElement('div');
            leagueHeader.className = 'league-header';
            leagueHeader.textContent = league;
            dropdownContent.appendChild(leagueHeader);
            
            // Add filtered teams
            filteredTeams.forEach(team => {
                const teamOption = document.createElement('div');
                teamOption.className = 'team-option';
                teamOption.innerHTML = `
                    <span class="team-flag">${getTeamFlag(league)}</span>
                    <span>${team}</span>
                `;
                teamOption.addEventListener('click', () => selectTeam(side, team));
                dropdownContent.appendChild(teamOption);
            });
        }
    });
    
    if (!hasResults) {
        dropdownContent.innerHTML = '<div class="no-results">No teams found</div>';
    }
}

// Select team
function selectTeam(side, teamName) {
    const searchInput = document.getElementById(side + 'TeamSearch');
    const hiddenInput = document.getElementById(side + 'Team');
    const dropdown = document.getElementById(side + 'Dropdown');
    
    if (searchInput && hiddenInput) {
        searchInput.value = teamName;
        hiddenInput.value = teamName;
        dropdown.classList.remove('show');
        updateButton();
    }
}

// Update button state - make it globally accessible
window.updateButton = function() {
    const homeTeam = document.getElementById('homeTeam').value;
    const awayTeam = document.getElementById('awayTeam').value;
    const analyzeBtn = document.getElementById('analyzeBtn');
    const btnText = analyzeBtn.querySelector('.btn-text');
    
    if (homeTeam && awayTeam && homeTeam !== awayTeam) {
        analyzeBtn.disabled = false;
        btnText.textContent = 'ANALYZE MATCH';
    } else {
        analyzeBtn.disabled = true;
        btnText.textContent = homeTeam && awayTeam && homeTeam === awayTeam ? 
            'Select different teams' : 'Select both teams';
    }
}

// Swap teams - make it globally accessible
window.swapTeams = function() {
    const homeInput = document.getElementById('homeTeam');
    const awayInput = document.getElementById('awayTeam');
    const homeSearch = document.getElementById('homeTeamSearch');
    const awaySearch = document.getElementById('awayTeamSearch');
    
    if (homeInput && awayInput && homeSearch && awaySearch) {
        // Swap hidden values
        const tempValue = homeInput.value;
        homeInput.value = awayInput.value;
        awayInput.value = tempValue;
        
        // Swap search display values
        const tempSearch = homeSearch.value;
        homeSearch.value = awaySearch.value;
        awaySearch.value = tempSearch;
        
        updateButton();
    }
}

// Analyze match - make it globally accessible
window.analyzeMatch = async function() {
    const homeTeam = document.getElementById('homeTeam').value;
    const awayTeam = document.getElementById('awayTeam').value;
    
    if (!homeTeam || !awayTeam) {
        alert('Please select both teams');
        return;
    }
    
    const analyzeBtn = document.getElementById('analyzeBtn');
    const btnText = analyzeBtn.querySelector('.btn-text');
    const btnIcon = analyzeBtn.querySelector('.btn-icon');
    
    // Show loading state
    analyzeBtn.disabled = true;
    btnText.textContent = 'Analyzing...';
    btnIcon.textContent = '⚡';
    btnIcon.style.animation = 'spin 1s linear infinite';
    
    try {
        const response = await fetch('/analyze', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                home_team: homeTeam,
                away_team: awayTeam
            })
        });
        
        const data = await response.json();
        
        // Display results using the existing showResults function
        if (window.showResults) {
            showResults(data);
        } else {
            console.error('showResults function not found');
        }
        
        // Show results container with smooth animation
        const resultsContainer = document.getElementById('resultsContainer');
        resultsContainer.style.display = 'block';
        resultsContainer.style.opacity = '0';
        resultsContainer.style.transform = 'translateY(20px)';
        
        setTimeout(() => {
            resultsContainer.style.transition = 'all 0.6s cubic-bezier(0.4, 0, 0.2, 1)';
            resultsContainer.style.opacity = '1';
            resultsContainer.style.transform = 'translateY(0)';
        }, 100);
        
        // Smooth scroll to results
        setTimeout(() => {
            resultsContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }, 200);
        
    } catch (error) {
        console.error('Error analyzing match:', error);
        alert('Error analyzing match. Please try again.');
    } finally {
        // Reset button
        analyzeBtn.disabled = false;
        btnText.textContent = 'ANALYZE MATCH';
        btnIcon.textContent = '⚡';
        btnIcon.style.animation = '';
    }
}

// Initialize on page load
document.addEventListener('DOMContentLoaded', function() {
    initializeTeamSelects();
    console.log('Simple team selection initialized');
});

// Add spin animation
const style = document.createElement('style');
style.textContent = `
    @keyframes spin {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
    }
`;
document.head.appendChild(style);
</script>